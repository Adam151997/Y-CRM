# Y CRM Performance Guide

## Bundle Analysis

Run bundle analysis to identify large dependencies:

```bash
npm run analyze
```

This generates interactive visualizations at:
- `.next/analyze/client.html` - Client bundle
- `.next/analyze/nodejs.html` - Server bundle

## Current Optimizations

### 1. Next.js Config

| Optimization | Description |
|--------------|-------------|
| `removeConsole` | Strips console.log in production (keeps error/warn) |
| `compress` | Enables gzip compression |
| `generateEtags` | Caching via ETags |
| `modularizeImports` | Tree-shakes lucide-react icons |

### 2. Code Splitting

- **Route-based splitting** - Each page loads independently
- **Dynamic imports** - Heavy components loaded on demand
- **React Query** - Deduplicates API requests

### 3. Caching Strategy

| Layer | Strategy |
|-------|----------|
| Browser | ETags + Cache-Control headers |
| CDN | Vercel Edge Network |
| API | React Query (staleTime: 5min) |
| Database | Prisma connection pooling |
| Rate Limiting | Redis caching |

## Lighthouse Audit Checklist

### Performance

- [ ] First Contentful Paint < 1.8s
- [ ] Largest Contentful Paint < 2.5s
- [ ] Time to Interactive < 3.8s
- [ ] Cumulative Layout Shift < 0.1
- [ ] Total Blocking Time < 200ms

### Best Practices

- [x] HTTPS enabled (via Vercel)
- [x] No mixed content
- [x] CSP headers (via Clerk)
- [ ] Add security headers middleware

### SEO

- [x] Meta tags in layout.tsx
- [x] Open Graph tags
- [x] Twitter cards
- [x] Robots.txt
- [x] Sitemap (auto-generated by Vercel)

### Accessibility

- [x] Semantic HTML
- [x] ARIA labels on interactive elements
- [x] Color contrast (Shadcn defaults)
- [x] Keyboard navigation
- [ ] Screen reader testing

## Recommended Improvements

### High Impact

1. **Image Optimization**
   ```tsx
   // Use next/image for all images
   import Image from 'next/image';
   <Image src={url} alt="..." width={100} height={100} />
   ```

2. **Lazy Load Heavy Components**
   ```tsx
   const HeavyChart = dynamic(() => import('./chart'), {
     loading: () => <Skeleton />,
     ssr: false,
   });
   ```

3. **Preload Critical Data**
   ```tsx
   // In layout.tsx or page.tsx
   export const metadata = {
     other: {
       'link': [
         { rel: 'preconnect', href: 'https://api.clerk.com' },
       ],
     },
   };
   ```

### Medium Impact

4. **Add Security Headers**
   ```tsx
   // middleware.ts
   export function middleware(request: NextRequest) {
     const response = NextResponse.next();
     response.headers.set('X-Frame-Options', 'DENY');
     response.headers.set('X-Content-Type-Options', 'nosniff');
     response.headers.set('Referrer-Policy', 'strict-origin-when-cross-origin');
     return response;
   }
   ```

5. **Optimize Font Loading**
   ```tsx
   // Already using next/font/google - optimal
   const inter = Inter({ 
     subsets: ["latin"],
     display: 'swap', // Add this
   });
   ```

### Low Impact

6. **Service Worker** (PWA)
7. **Prefetch on hover**
8. **Virtualized lists for large datasets**

## Monitoring

### Vercel Analytics

Enable in `app/layout.tsx`:
```tsx
import { Analytics } from '@vercel/analytics/react';
import { SpeedInsights } from '@vercel/speed-insights/next';

// In the body:
<Analytics />
<SpeedInsights />
```

### Manual Lighthouse

```bash
# Install Lighthouse CLI
npm install -g lighthouse

# Run audit
lighthouse https://y-crm.vercel.app --view
```

## Bundle Size Targets

| Bundle | Target | Current |
|--------|--------|---------|
| First Load JS | < 100KB | Run analyze |
| Per-page JS | < 50KB | Run analyze |
| Total CSS | < 50KB | Run analyze |

## Quick Wins Checklist

- [x] Remove console.log in prod
- [x] Enable compression
- [x] Modularize icon imports
- [ ] Add `display: 'swap'` to font
- [ ] Add Vercel Analytics
- [ ] Add security headers
- [ ] Audit with Lighthouse
